%YAML 1.2
---
# See http://www.sublimetext.com/docs/3/syntax.html
file_extensions:
  - play
  - liber
scope: source.liber

contexts:
  main:
    - include: è¨»é‡‹
    - include: å°è©±
    - include: åµŒå…¥py
    - include: åµŒå…¥html
    - include: åµŒå…¥js
    - include: èºé»
    - include: åŠŸèƒ½
    - include: é¡é ­
    - include: é¡é ­
    - include: è·³è½‰
    - include: åœ–ç‰‡
    - include: æŒçºŒ
    - include: æ—ç™½

  è¨»é‡‹:
    - match: '^#'
      scope: punctuation.definition.comment.liber
      push:
        - meta_scope: comment.line.double-slash.liber
        - match: $
          pop: true

  èºé»:
    - match: '\*'
      push:
        - meta_scope: keyword.control.label.liber
        - match: $
          pop: true

  åŠŸèƒ½:
    - match: '^>'
      scope: support.function.builtin.liber
      push:
        - match: '$'
          pop: true
        - match: '(?=\S+\(.*\))'
          push:
            - include: 'scope:source.python'
          with_prototype:
            - match: $
              pop: true
        - match: '\w+\b'
          scope: variable.function.liber
          push:
            - meta_include_prototype: true
            - meta_scope: variable.parameter.liber
            - match: '$'
              pop: true
        - match: '$'
          pop: true

  å°è©±:
    - match: '(^[^\)]+?)(?=(?=[ :ï¼š\|ï½œğŸ´\(\[ã€Œ"])(?:\s*[\|ï½œğŸ´]\s*([^\s\)]*?))?\s*\[[^\]\s]*?\]\s*?(?![\(ã€Œ":ï¼š])$)'
      scope: entity.name.tag.liber
      push:
        - match: '[\|ï½œğŸ´]'
          scope: keyword.operator.binary.liber
        - match: '\[\S*\]'
          scope: invalid.illegal.missing-attribute.liber
        - match: $
          pop: true
    - match: (^[^>+-?"ã€Œ ]\S*?)(?=(?=[ :ï¼š\|ï½œğŸ´\(\[ã€Œ"])(?:[\|ï½œğŸ´]\s*(\S*?))?(?:\s*(\(.+?)?|\s*(\[.+?)?)*(\s*(?:[:ï¼š].*)|\s*(?:[ã€Œ"].*)?$))
      scope: entity.name.tag.liber
      push:
        - include: æ–‡æœ¬
        - match: '(?:\[\S*\]|\(\S*\))\s*(?:\[\S*\]|\(\S*\))\s*(?:\[\S*\]|\(\S*\))+'
          scope: invalid.illegal.unexpected-attribute.liber
        - match: '(\[\S*\]\s*\(\S*\))'
          scope: invalid.illegal.attribute-order.liber
        - match: '[\)\]]'
          scope: invalid.illegal.stray-bracket-end.liber
        - match: '\('
          scope: punctuation.definition.delimeter.parenthesis.liber
          push:
            - meta_scope: entity.other.attribute-name.liber
            - match: '\s'
              pop: true
            - match: '\)'
              pop: true
        - match: '\['
          scope: punctuation.definition.delimeter.brackets.liber
          push:
            - meta_scope: entity.other.attribute-name.liber
            - match: \s
              pop: true
            - match: '\]'
              pop: true
        - match: '\s+[\|ï½œğŸ´]\s+|\s+[\|ï½œğŸ´]|[\|ï½œğŸ´]\s+'
          scope: invalid.illegal.extra-spaces.liber
        - match: '[\|ï½œğŸ´]'
          scope: keyword.operator.binary.liber
        - match: '(?<=.)[:ï¼š]'
          scope: keyword.operator.binary.liber
        - match: '(?<=(ã€|"))'
          pop: true
        - match: '$'
          pop: true

  é¡é ­:
    - match: '^[+-]'
      scope: support.function.builtin.liber
      push:
        - match: '$'
          pop: true
        - match: ''
          push:
            - include: 'scope:source.yaml'
          with_prototype:
            - match: $
              pop: true

  æ—ç™½:
    - match: ^.+
      scope: text.plain.liber

  æ–‡æœ¬:
    - match: 'ã€Œ[\s\S]*?'
      scope: punctuation.definition.string.liber
      push:
        - meta_scope: string.quoted.ideographic.liber
        - match: 'ã€'
          scope: punctuation.definition.string.liber
          pop: true
    - match: '"[\s\S]*?'
      scope: punctuation.definition.string.liber
      push:
        - meta_scope: string.quoted.double.liber
        - match: '"'
          scope: punctuation.definition.string.liber
          pop: true  
    - match: '(?<=[:ï¼š]).+'
      push:
        - meta_scope: string.quoted.liber
        - match: '$'
          pop: true

  è·³è½‰:
    - match: ^(\?)\s*(.+?)\s*(->)\s*(\S+?)\s*(,?)\s*(\S+)$
      captures:
        1: support.function.builtin.liber
        2: variable.parameter.liber
        3: keyword.operator.binary.liber
        4: variable.function.liber
        5: punctuation.separator.liber
        6: variable.function.liber


  åœ–ç‰‡:
    - match: ^(={3,})(.+)$$
      captures:
        1: support.function.builtin.liber
        2: variable.parameter.liber

  æŒçºŒ:
    - match: ^(@)\s*(\S+?)\s*([\|+-])?\s*([^\|+-]+?)$
      captures:
        1: support.function.builtin.liber
        2: variable.parameter.liber
        3: keyword.operator.binary.liber
        4: variable.function.liber

  åµŒå…¥html:
    - match: '^(```(HTML|html)?)$'
      scope: support.function.liber
      push:
        - match: '```'
          scope: support.function.liber
          pop: true

        - match: '\s*'
          push:
            - include: 'scope:text.html.basic'
          with_prototype:
             - match: '(?=(```))'
               pop: true
  åµŒå…¥py:
    - match: '^(```(py|python)?)$'
      scope: support.function.liber
      push:
        - match: '```'
          scope: support.function.liber
          pop: true

        - match: '\s*'
          push:
            - include: 'scope:source.python'
          with_prototype:
             - match: '(?=(```))'
               pop: true
  åµŒå…¥js:
    - match: '^(```(js|javascript)?)$'
      scope: support.function.liber
      push:
        - match: '```'
          scope: support.function.liber
          pop: true

        - match: '\s*'
          push:
            - include: 'scope:source.js'
          with_prototype:
             - match: '(?=(```))'
               pop: true

